#!/usr/bin/env bash

command cd $HOME
_xdg_config_home=${XDG_CONFIG_HOME:-$HOME/.config}
_xdg_data_home=${XDG_DATA_HOME:-$HOME/.local/share}
command mkdir -p ${_xdg_config_home} ${_xdg_data_home} ~/.ssh ~/.unison ~/bin

if [[ ! -d ${_xdg_config_home}/dotfiles ]]; then
  if (( $UID == 0 )); then
    ln -s ~kshenoy/.config/dotfiles ${_xdg_config_home}/dotfiles
  fi
fi

if [[ ! -d ${_xdg_config_home}/dotfiles-priv ]]; then
  if (( $UID == 0 )); then
    ln -s ~kshenoy/.config/dotfiles-priv ${_xdg_config_home}/dotfiles-priv
  else
    git clone git@github.com:kshenoy/dotfiles-priv ${_xdg_config_home}/dotfiles-priv
  fi
fi

# Doom emacs repo
if [[ ! -d ${_xdg_config_home}/doom-emacs ]]; then
  git clone https://github.com/hlissner/doom-emacs ${_xdg_config_home}/doom-emacs
fi

# Emacs profile selector
if [[ ! -f $HOME/.emacs ]]; then
  wget -O $HOME/.emacs https://raw.githubusercontent.com/plexus/chemacs/master/.emacs
fi

if (( $UID != 0 )); then
  ln -svTf ${_xdg_config_home}/dotfiles{-priv,}/vim/pack/rc_local
fi

if [[ ! -d ${_xdg_config_home}/base16-shell ]]; then
  if (( $UID == 0 )); then
    ln -s ~kshenoy/.config/base16-shell ${_xdg_config_home}/base16-shell
  else
    git clone https://github.com/chriskempson/base16-shell.git ${_xdg_config_home}/base16-shell
  fi
fi

if [[ ! -d ${_xdg_config_home}/base16-fzf ]]; then
  if (( $UID == 0 )); then
    ln -s ~kshenoy/.config/base16-fzf ${_xdg_config_home}/base16-fzf
  else
    git clone https://github.com/fnune/base16-fzf ${_xdg_config_home}/base16-fzf
  fi
fi

if (( $UID == 0 )); then
  ln -s ~kshenoy/.local/share/bash_history ${_xdg_data_home}/bash_history
else
  mkdir -p ${_xdg_data_home}/bash_history
fi
command rm -i ~/.bash_history 2> /dev/null

# Create a pipe. Woo!
if [[ ! -p ~/pipe ]]; then
  mkfifo ~/pipe
fi
